(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{BIHw:function(e,t,n){"use strict";var r=n("I+eb"),i=n("or9q"),o=n("ewvW"),a=n("UMSQ"),s=n("ppGB"),l=n("ZfDv");r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=a(t.length),r=l(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:s(e)),r}})},QGkA:function(e,t,n){n("RNIs")("flat")},XIxq:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),i=n.n(r),o=n("PjpU"),a=n("yTmA"),s=n("7oih"),l=(n("BIHw"),n("QGkA"),n("HaE+")),c=n("dI71"),u=n("eHHv"),f=n("ZCxb"),d=n.n(f),m=n("cWnB"),h=n("JeC3"),p=n("kT3S"),g=n("lEpx"),v=n("3Z9Z"),w=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).slider=i.a.createRef(),t.isDown=!1,t.startX=null,t.scrollLeft=null,t.handleMouseDown=function(e){t.isDown=!0,t.startX=e.pageX-t.slider.current.offsetLeft,t.scrollLeft=t.slider.current.scrollLeft},t.handleMouseUp=function(e){t.isDown=!1},t.handleMouseMove=function(e){if(t.isDown){e.preventDefault();var n=3*(e.pageX-t.slider.current.offsetLeft-t.startX);t.slider.current.scrollLeft=t.scrollLeft-n}},t.handleMouseLeave=function(e){t.isDown=!1},t}return Object(c.a)(t,e),t.prototype.render=function(){return i.a.createElement(v.a,{style:{flexWrap:"unset",overflowX:"auto",justifyContent:"flex-start"},ref:this.slider,onMouseDown:this.handleMouseDown,onMouseLeave:this.handleMouseLeave,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp},this.props.children)},t}(r.Component),y=n("JI6e"),b=function(e){var t=e.date,n=e.timeslotLength,o=e.userSelectedSlots,a=(e.slotsWithOpening,e.selectTimeslot),s=e.unselectTimeslot,l=e.startHour,c=e.endHour,u=Object(r.useState)(!1),f=u[0],d=u[1],m=4*(c-l),p=Array.from(Array(m),(function(e,t){return 15*t})),g=n/15,v=function(e){var n=l+Math.floor(e/60),r=e%60;return new Date(t.getFullYear(),t.getMonth(),t.getDate(),n,r)},w=function(e){var t=e.getHours()%12;return 0===t&&(t=12),(t=t.toString().padStart(2,"0"))+":"+e.getMinutes().toString().padStart(2,"0")+" "+(e.getHours()>=12?"PM":"AM")},b=function(e,r){if(o.hasOwnProperty(e)){var i=o[e][0];return s(new Date(t.getFullYear(),t.getMonth(),t.getDate(),l+Math.floor(i/60),i%60))}if(function(e,t){if(t+g>p.length)return!1;for(var r=e+n,i=e;i<r;i+=15)if(o.hasOwnProperty(i))return!1;return!0}(e,r)){var c=e;return a(new Date(t.getFullYear(),t.getMonth(),t.getDate(),l+Math.floor(c/60),c%60))}d(!0)};return i.a.createElement(y.a,{style:{width:300,flex:"none"}},i.a.createElement("div",{style:{position:"fixed"}},i.a.createElement(h.a,{onClose:function(){return d(!1)},show:f,delay:3e3,autohide:!0},i.a.createElement(h.a.Body,null,i.a.createElement("strong",{className:"mr-auto",style:{color:"red"}},"Invalid option/timeslot conflict!")))),i.a.createElement("strong",null,t.toDateString()),p.map((function(e,t){var n=function(e,t){var n=t.hasOwnProperty(e);return{isSelected:n,isTop:n&&e===t[e][0],isMiddle:n&&!t[e].includes(e),isBottom:n&&e===t[e][1]}},r=function(e){var t=n(e,o),r=t.isTop,i=t.isMiddle,a=t.isBottom;return Object.assign({},{padding:10,cursor:"pointer",display:"flex",justifyContent:"space-between"},{borderLeft:"1px solid black",borderRight:"1px solid black",borderTop:a||i?"none":"1px solid black",borderBottom:r||i?"none":"1px solid black",background:o.hasOwnProperty(e)?"green":"white"})},a=n(e,o),s=a.isSelected,l=a.isTop,c=a.isMiddle,u=a.isBottom,f=function(n){var o=n.children;return i.a.createElement("div",{style:Object.assign({},r(e)),onClick:function(){return b(e,t)}},o)};if(s){if(l)return i.a.createElement(f,{key:e},i.a.createElement("span",null,w(v(e))));if(c)return i.a.createElement(f,{key:e},"-");if(u)return i.a.createElement(f,{key:e},i.a.createElement("span",null,w(v(e+15))))}return i.a.createElement("div",{style:Object.assign({},r(e)),key:e,onClick:function(){return b(e,t)}},i.a.createElement("span",null,w(v(e))),i.a.createElement("span",null,"-"),i.a.createElement("span",null,w(v(e+15))))})))},T=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this)._initFirebase=!1,t.state={settings:null,loading:!0,error:null,showToast:!1,selectedTimeslots:{},firstDataLoad:!0,runningTransaction:!1},t.unsub=null,t.loadSettings=Object(l.a)((function*(){t._initFirebase=!0;var e=yield t.props.firebase.generalSettings().get();if(e.exists){var n=e.data(),r={};n.timeslotDays=n.timeslotDays.map((function(e){var t=e.toDate();return r[t.toDateString()]=[],t})),t.setState({settings:n,selectedTimeslots:r},(function(){t.unsub=t.props.firebase.timeslots().onSnapshot((function(e){var n=t.state.selectedTimeslots;e.docs.map((function(e){return Object.assign({},e.data(),{time:e.data().time.toDate(),id:e.id})})).forEach((function(e){var t=e.time.toDateString();if(n.hasOwnProperty(t)){var r=n[t].findIndex((function(t){return t.id===e.id}));r>-1?n[t][r]=e:n[t].push(e)}else n[t]=[e]})),t.setState({selectedTimeslots:n,loading:!1,firstDataLoad:!1})}),console.error)}))}else t.setState({error:"Failed to load timeslots!"})})),t.saveTimeslots=Object(l.a)((function*(){var e=t.props.firebase,n=t.context,r=t.state,i=r.selectedTimeslots,o=r.settings;t.setState({selectedTimeslots:o.timeslotDays.reduce((function(e,t){return e[t.toDateString()]=[],e}),{}),runningTransaction:!0});var a=yield e.timeslots().get().then((function(e){return e.docs.map((function(e){return Object.assign({},e.data(),{time:e.data().time.toDate(),id:e.id})}))})),s=Object.values(i).flat().filter((function(e){return e.interviewers.hasOwnProperty(n.uid)})),c={};s.forEach((function(e,t){return c[e.time]=t}));var u=function(){var e=Object(l.a)((function*(e,t){for(var n=0;n<e.length;n++)yield t(e[n],n,e)}));return function(t,n){return e.apply(this,arguments)}}();try{yield e.firestoreRoot.runTransaction(function(){var t=Object(l.a)((function*(t){u(a.filter((function(e){return e.interviewers.hasOwnProperty(n.uid)})),function(){var r=Object(l.a)((function*(r,i){if(!c.hasOwnProperty(r.time)){var o=a[i],s=o.id;delete o.id,delete o.interviewers[n.uid],0!==Object.keys(o.interviewers).length||o.hasOwnProperty("applicant")?t.update(e.timeslot(s),o):t.delete(e.timeslot(s))}}));return function(e,t){return r.apply(this,arguments)}}()),yield u(s,function(){var r=Object(l.a)((function*(r){var i=a.filter((function(e){return e.time.getTime()===r.time.getTime()}));if(i.every((function(e){return!e.interviewers.hasOwnProperty(n.uid)}))){var o=!1;if(yield u(i,function(){var r=Object(l.a)((function*(r){if(!o){var i=yield t.get(e.timeslot(r.id)),a=Object.assign({},i.data());Object.keys(a.interviewers).length<2&&(a.interviewers[n.uid]=n.name,t.update(e.timeslot(r.id),a),o=!0)}}));return function(e){return r.apply(this,arguments)}}()),!o){({})[n.uid]=n.name;var s=e.timeslots().doc();t.set(s,r)}}}));return function(e){return r.apply(this,arguments)}}())}));return function(e){return t.apply(this,arguments)}}())}catch(f){t.setState({selectedTimeslots:i}),console.error("Transaction failure!",f),d()("Uh oh!","Something went wrong with saving your selections! Please refresh the page and try again!","error")}t.setState({showToast:!0,runningTransaction:!1}),window.scrollTo(0,document.body.scrollHeight)})),t.selectTimeslot=function(e){var n=e.toDateString(),r=t.state,i=r.selectedTimeslots,o=r.settings.timeslotLength,a=t.context,s=!1;if(i[n].filter((function(e){return!e.interviewers.hasOwnProperty(a.uid)})).forEach((function(t){t.time.getTime()===e.getTime()&&Object.keys(t.interviewers).length<2&&!s&&(t.interviewers[a.uid]=a.name,s=!0)})),!s){var l={};l[a.uid]=a.name,i[n].push({time:e,interviewers:l,timeslotLength:o})}t.setState({selectedTimeslots:i})},t.unselectTimeslot=function(e){var n=e.toDateString(),r=t.state.selectedTimeslots,i=t.context;r[n]=r[n].map((function(t){return t.interviewers.hasOwnProperty(i.uid)&&t.time.getTime()===e.getTime()&&delete t.interviewers[i.uid],t})),r[n]=r[n].filter((function(e){return Object.keys(e.interviewers).length>0||e.hasOwnProperty("applicant")})),t.setState({selectedTimeslots:r})},t.timeslotsToSlots=function(e){var n=t.state.settings.timeslotStart,r={};return e.forEach((function(e){for(var i=60*(e.time.getHours()-n)+e.time.getMinutes(),o=i+t.state.settings.timeslotLength-15,a=i;a<=o;a+=15)r[a]=[i,o]})),r},t}Object(c.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.firebase&&!this._initFirebase&&this.loadSettings()},n.componentDidUpdate=function(e){this.props.firebase&&!this._initFirebase&&this.loadSettings()},n.componentWillUnmount=function(){"function"==typeof this.unsub&&this.unsub()},n.render=function(){var e=this,t=this.state,n=t.loading,r=t.runningTransaction,o=t.error,a=t.selectedTimeslots,s=t.showToast;if(n||r)return i.a.createElement(p.a,null);if(o)return i.a.createElement(g.b,{flexdirection:"column"},i.a.createElement("h1",null,o));var l=this.state.settings,c=l.timeslotsOpen,u=l.timeslotsOpenForApplicants,f=l.timeslotLength,d=l.timeslotDays,v=l.timeslotStart,y=l.timeslotEnd,T=this.context;return c?T.roles.applicant&&!u?i.a.createElement(g.b,{flexdirection:"column"},i.a.createElement("h1",null,"Timeslot selection isn't open yet!")):i.a.createElement(g.b,{flexdirection:"column"},i.a.createElement("h1",null,"Interviewer Timeslot Selection"),i.a.createElement(w,null,d.map((function(t,n){var r=a[t.toDateString()],o=r?e.timeslotsToSlots(r.filter((function(e){return e.interviewers.hasOwnProperty(T.uid)}))):{},s=r?e.timeslotsToSlots(r.filter((function(e){return!e.interviewers.hasOwnProperty(T.uid)&&Object.keys(e.interviewers).length<2}))):{};return i.a.createElement(b,{key:n,date:t,timeslotLength:f,userSelectedSlots:o,slotsWithOpening:s,selectTimeslot:e.selectTimeslot,unselectTimeslot:e.unselectTimeslot,startHour:v,endHour:y})}))),i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement(m.a,{style:{width:"fit-content",marginTop:20,marginBottom:20},onClick:this.saveTimeslots},"Save Selections"),i.a.createElement(h.a,{onClose:function(){return e.setState({showToast:!1})},show:s,delay:3e3,autohide:!0,style:{width:"fit-content",height:"fit-content",marginLeft:25}},i.a.createElement(h.a.Header,null,i.a.createElement("strong",{className:"mr-auto"},"Selections Saved!"))))):i.a.createElement(g.b,{flexdirection:"column"},i.a.createElement("h1",null,"Timeslot selection is closed!"))},t}(r.Component);T.contextType=a.AuthUserContext;var E=Object(u.a)(Object(a.withAuthorization)(o.d),a.withFirebase)(T),O=Object(u.a)(Object(a.withAuthorization)(o.b),a.withFirebase)((function(e){e.firebase;return i.a.createElement(g.b,{flexdirection:"column"},i.a.createElement("h1",null,"Applicant Timeslot Selection"))})),S=function(e){var t=e.location,n=Object(r.useContext)(a.AuthUserContext);return Object(o.d)(n)?i.a.createElement(E,{location:t}):i.a.createElement(O,{location:t})};t.default=function(){return i.a.createElement(s.a,null,i.a.createElement(S,null))}},or9q:function(e,t,n){"use strict";var r=n("6LWA"),i=n("UMSQ"),o=n("A2ZE"),a=function(e,t,n,s,l,c,u,f){for(var d,m=l,h=0,p=!!u&&o(u,f,3);h<s;){if(h in n){if(d=p?p(n[h],h,t):n[h],c>0&&r(d))m=a(e,t,d,i(d.length),m,c-1)-1;else{if(m>=9007199254740991)throw TypeError("Exceed the acceptable array length");e[m]=d}m++}h++}return m};e.exports=a}}]);
//# sourceMappingURL=component---src-pages-timeslots-js-f0838564c1f8b01ff73e.js.map