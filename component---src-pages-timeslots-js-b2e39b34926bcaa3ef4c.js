(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{XIxq:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),a=n.n(r),i=n("PjpU"),o=n("yTmA"),s=n("7oih"),l=n("o0o1"),c=n.n(l),u=(n("ls82"),n("HaE+")),m=n("dI71"),d=n("eHHv"),p=n("ZCxb"),f=n.n(p),h=n("zT9C"),b=n.n(h),w=n("cWnB"),v=n("zM5D"),g=n("6xyR"),y=n("xkma"),x=n("kT3S"),O=n("lEpx"),E=n("XZaY"),k=n("vOnD"),j=n("JI6e"),S=n("JeC3"),T=k.default.div.withConfig({displayName:"ScheduleColumn__StyledSlot",componentId:"mbms9c-0"})(["padding:10px;cursor:pointer;display:flex;justify-content:space-between;background:",";border-left:",";border-right:",";border-top:",";border-bottom:",";",""],(function(e){return e.userSelected?"green":e.hasOpening?"blue":e.orphanedApplicant?"red":"white"}),"1px solid black","1px solid black",(function(e){return e.isBottom||e.isMiddle?"none":"1px solid black"}),(function(e){return e.isTop||e.isMiddle?"none":"1px solid black"}),(function(e){if(!e.userSelected){for(var t="\n      &:hover {\n        background: rgba(0, 128, 0, 0.5);\n        border-bottom: none;\n      }\n    ",n=" + div",r=1;r<e.slotsPerTimeslot;r++)t+="&:hover "+n+" {\n        background: rgba(0, 128, 0, 0.5);\n        border-top: none;\n        border-bottom: "+(r+1===e.slotsPerTimeslot?"1px solid black":"none")+";\n      }",n+=" + div";return t}})),D=function(e){var t=e.date,n=e.timeslotLength,i=e.userSelectedSlots,o=e.slotsWithOpening,s=e.orphanedApplicants,l=e.selectTimeslot,c=e.unselectTimeslot,u=e.startHour,m=e.endHour,d=Object(r.useState)(!1),p=d[0],f=d[1],h=4*(m-u),b=Array.from(Array(h),(function(e,t){return 15*t})),w=n/15,v=function(e){var n=u+Math.floor(e/60),r=e%60;return new Date(t.getFullYear(),t.getMonth(),t.getDate(),n,r)};return a.a.createElement(j.a,{style:{width:300,flex:"none"}},a.a.createElement("div",{style:{position:"fixed"}},a.a.createElement(S.a,{onClose:function(){return f(!1)},show:p,delay:3e3,autohide:!0},a.a.createElement(S.a.Body,null,a.a.createElement("strong",{className:"mr-auto",style:{color:"red"}},"Invalid option/timeslot conflict!")))),a.a.createElement("strong",null,t.toDateString()),b.map((function(e,r){var m=function(e,t){var n=t.hasOwnProperty(e);return{isSelected:n,isTop:n&&e===t[e][0],isMiddle:n&&!t[e].includes(e),isBottom:n&&e===t[e][1]}}(e,i),d=m.isSelected,p=m.isTop,h=m.isMiddle,g=m.isBottom,x=function(m){var d=m.children;return a.a.createElement(T,{slotsPerTimeslot:w,hasOpening:o.hasOwnProperty(e),userSelected:i.hasOwnProperty(e),orphanedApplicant:s.hasOwnProperty(e),isTop:p,isMiddle:h,isBottom:g,onClick:function(){return function(e,r){if(i.hasOwnProperty(e)){var a=i[e][0];return c(new Date(t.getFullYear(),t.getMonth(),t.getDate(),u+Math.floor(a/60),a%60))}if(function(e,t){if(t+w>b.length)return!1;for(var r=e+n,a=e;a<r;a+=15)if(i.hasOwnProperty(a))return!1;return!0}(e,r)){var o=e;return l(new Date(t.getFullYear(),t.getMonth(),t.getDate(),u+Math.floor(o/60),o%60))}f(!0)}(e,r)}},d)};if(d){if(p)return a.a.createElement(x,{key:e},a.a.createElement("span",null,Object(y.a)(v(e))));if(h)return a.a.createElement(x,{key:e},"-");if(g)return a.a.createElement(x,{key:e},a.a.createElement("span",null,Object(y.a)(v(e+15))))}return a.a.createElement(x,{key:e},a.a.createElement("span",null,Object(y.a)(v(e))),a.a.createElement("span",null,"-"),a.a.createElement("span",null,Object(y.a)(v(e+15))))})))},P=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this)._initFirebase=!1,t.state={loading:!0,error:null,settings:null,timeslots:{},timeslotOptions:[],showModal:!1},t.unsub=null,t.loadSettings=Object(u.a)(c.a.mark((function e(){var n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._initFirebase=!0,e.next=3,t.props.firebase.generalSettings().get();case 3:(n=e.sent).exists?(r=n.data(),a={},r.timeslotDays=r.timeslotDays.map((function(e){var t=e.toDate();return a[t.toDateString()]=[],t})),t.setState({settings:r,timeslots:a},(function(){t.unsub=t.props.firebase.timeslots().onSnapshot((function(e){var n=t.state.timeslots,r=e.docs.map((function(e){return Object.assign({},e.data(),{time:e.data().time.toDate(),id:e.id})}));r.filter((function(e){return Object.keys(e.interviewers).length<2})).forEach((function(e){var t=e.time.toDateString();if(n.hasOwnProperty(t)){var r=n[t].findIndex((function(t){return t.id===e.id}));r>-1?n[t][r]=e:n[t].push(e)}else n[t]=[e]}));var a=r.map((function(e){return e.id}));for(var i in n)n[i]=n[i].filter((function(e){return a.includes(e.id)}));t.setState({timeslots:n,loading:!1})}),console.error)}))):t.setState({error:"Failed to load timeslots!"});case 5:case"end":return e.stop()}}),e)}))),t.selectTimeslot=function(){var e=Object(u.a)(c.a.mark((function e(n){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.context,a=t.props.firebase,e.prev=2,e.next=5,a.firestore.runTransaction(function(){var e=Object(u.a)(c.a.mark((function e(t){var i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get(a.timeslot(n.id));case 2:i=e.sent,o=Object.assign({},i.data()),Object.keys(o.interviewers).length<2?(o.interviewers[r.uid]=r.name,t.update(a.timeslot(n.id),o)):f()("Uh oh!","Someone else has just registered this timeslot! Please select another.","error");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Transaction failure!",e.t0),f()("Uh oh!","Something went wrong with saving your selections! Please refresh the page and try again!","error");case 11:t.setState({showModal:!1,timeslotOptions:[]});case 12:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),t.addNewTimeslot=function(){var e=Object(u.a)(c.a.mark((function e(n){var r,a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state.settings.timeslotLength,a=t.context,(i={})[a.uid]=a.name,e.next=6,t.props.firebase.timeslots().add({time:n,interviewers:i,timeslotLength:r});case 6:t.setState({showModal:!1});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.selectTimeslotByDate=function(){var e=Object(u.a)(c.a.mark((function e(n){var r,a,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.toDateString(),a=t.state.timeslots,i=t.context,0!==(o=a[r].filter((function(e){return!e.interviewers.hasOwnProperty(i.uid)&&e.time.getTime()===n.getTime()}))).length){e.next=9;break}return e.next=7,t.addNewTimeslot(n);case 7:e.next=10;break;case 9:t.setState({showModal:!0,timeslotOptions:o});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.unselectTimeslot=function(){var e=Object(u.a)(c.a.mark((function e(n){var r,a,i,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.toDateString(),a=t.state.timeslots,i=t.context,o=b()(a[r].find((function(e){return e.interviewers.hasOwnProperty(i.uid)&&e.time.getTime()===n.getTime()}))),s=o.id,delete o.id,delete o.interviewers[i.uid],0!==Object.keys(o.interviewers).length||o.hasOwnProperty("applicant")){e.next=12;break}return e.next=10,t.props.firebase.timeslot(s).delete();case 10:e.next=14;break;case 12:return e.next=14,t.props.firebase.timeslot(s).update(o);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.timeslotsToSlots=function(e){var n=t.state.settings.timeslotStart,r={};return e.forEach((function(e){for(var a=60*(e.time.getHours()-n)+e.time.getMinutes(),i=a+t.state.settings.timeslotLength-15,o=a;o<=i;o+=15)r[o]=[a,i]})),r},t}Object(m.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.firebase&&!this._initFirebase&&this.loadSettings()},n.componentDidUpdate=function(e){this.props.firebase&&!this._initFirebase&&this.loadSettings()},n.componentWillUnmount=function(){"function"==typeof this.unsub&&this.unsub()},n.render=function(){var e=this,t=this.state,n=t.loading,r=t.runningTransaction,i=t.error,o=t.timeslots,s=t.showModal,l=t.timeslotOptions;if(n||r)return a.a.createElement(x.a,null);if(i)return a.a.createElement(O.c,{flexdirection:"column"},a.a.createElement("h1",null,i));var c=this.state.settings,u=c.timeslotsOpen,m=c.timeslotsOpenForApplicants,d=c.timeslotLength,p=c.timeslotDays,f=c.timeslotStart,h=c.timeslotEnd,b=this.context;return u?b.roles.applicant&&!m?a.a.createElement(O.c,{flexdirection:"column"},a.a.createElement("h1",null,"Timeslot selection isn't open yet!")):a.a.createElement(O.c,{flexdirection:"column"},a.a.createElement("h1",null,"Interviewer Timeslot Selection"),a.a.createElement(E.a,null,p.sort((function(e,t){return e-t})).map((function(t,n){var r=o[t.toDateString()],i=r?e.timeslotsToSlots(r.filter((function(e){return e.interviewers.hasOwnProperty(b.uid)}))):{},s=r?e.timeslotsToSlots(r.filter((function(e){return!e.interviewers.hasOwnProperty(b.uid)&&1===Object.keys(e.interviewers).length}))):{},l=r?e.timeslotsToSlots(r.filter((function(e){return e.hasOwnProperty("applicant")&&0===Object.keys(e.interviewers).length}))):{};return a.a.createElement(D,{key:n,date:t,timeslotLength:d,userSelectedSlots:i,slotsWithOpening:s,orphanedApplicants:l,selectTimeslot:e.selectTimeslotByDate,unselectTimeslot:e.unselectTimeslot,startHour:f,endHour:h})}))),a.a.createElement(v.a,{show:s,onHide:function(){return e.setState({showModal:!1})}},a.a.createElement(v.a.Header,{closeButton:!0},a.a.createElement(v.a.Title,null,"Choose a timeslot")),a.a.createElement(v.a.Body,null,a.a.createElement(E.a,null,l.map((function(t){return a.a.createElement(g.a,{key:t.id,style:{minWidth:"15rem",margin:"0 10px",cursor:"pointer"},onClick:function(){return e.selectTimeslot(t)}},a.a.createElement(g.a.Body,null,a.a.createElement(g.a.Title,null,"Interviewer: ",Object.values(t.interviewers).join(", ")),t.applicant&&a.a.createElement(g.a.Subtitle,{className:"mb-2 text-muted"},"Applicant: ",t.applicant.name),a.a.createElement(g.a.Subtitle,{className:"mb-2 text-muted"},Object(y.a)(t.time))))})),l.length>0&&a.a.createElement(g.a,{style:{minWidth:"15rem",margin:"0 10px",cursor:"pointer"},onClick:function(){return e.addNewTimeslot(l[0].time)}},a.a.createElement(g.a.Body,null,a.a.createElement(g.a.Title,null,"Create new slot"),a.a.createElement(g.a.Subtitle,{className:"mb-2 text-muted"},Object(y.a)(l[0].time)))))),a.a.createElement(v.a.Footer,null,a.a.createElement(w.a,{variant:"secondary",onClick:function(){return e.setState({showModal:!1})}},"Cancel")))):a.a.createElement(O.c,{flexdirection:"column"},a.a.createElement("h1",null,"Timeslot selection is closed!"))},t}(r.Component);P.contextType=o.AuthUserContext;var C=Object(d.a)(Object(o.withAuthorization)(i.f),o.withFirebase)(P),M=Object(k.default)(g.a).withConfig({displayName:"ApplicantView__TimeslotCard",componentId:"s6tk4s-0"})(["width:18rem;margin:10px;cursor:pointer;background:",";&:hover{background:",";}"],(function(e){return e.selected?"#87fb87":"white"}),(function(e){return e.selected?"#fb8787":"#87fb87"})),A=Object(d.a)(Object(o.withAuthorization)(i.b),o.withFirebase)((function(e){var t=e.firebase,n=Object(r.useContext)(o.AuthUserContext),i=Object(r.useState)({}),s=i[0],l=i[1],m=Object(r.useState)({}),d=m[0],p=m[1],h=Object(r.useState)(!0),w=h[0],v=h[1],k=Object(r.useState)(null),S=k[0];k[1];if(Object(r.useEffect)((function(){if(t){var e=t.timeslots().onSnapshot((function(e){var t=e.docs.map((function(e){return Object.assign({},e.data(),{time:e.data().time.toDate(),id:e.id})})).filter((function(e){var t;return(null==e?void 0:null===(t=e.applicant)||void 0===t?void 0:t.uid)===n.uid||!e.hasOwnProperty("applicant")&&Object.keys(e.interviewers).length>0}));p(t.find((function(e){var t;return(null==e?void 0:null===(t=e.applicant)||void 0===t?void 0:t.uid)===n.uid}))||{}),t.forEach((function(e){var t=e.time.toDateString();if(s.hasOwnProperty(t)){var n=s[t].findIndex((function(t){return t.id===e.id}));n>-1?s[t][n]=e:s[t].push(e)}else s[t]=[e]}));var r=t.map((function(e){return e.id}));for(var a in s)s[a]=s[a].filter((function(e){return r.includes(e.id)}));l(b()(s))}),console.error);return v(!1),function(){return e()}}}),[t]),S)return a.a.createElement(O.c,{flexdirection:"column"},a.a.createElement("h1",null,S));if(w)return a.a.createElement(x.a,null);var T=function(e){var r=e.date,i=e.slots,o=function(){var e=Object(u.a)(c.a.mark((function e(r){var i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.id,o="schedule",e.prev=2,e.next=5,t.firestore.runTransaction(function(){var e=Object(u.a)(c.a.mark((function e(r){var a,s,l,u,m,f,h,b,w,v,g,y,x,O;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Object.keys(d).length||d.constructor!==Object){e.next=13;break}return a=t.timeslot(i),e.next=4,r.get(a);case 4:if(s=e.sent,!(l=Object.assign({},s.data())).hasOwnProperty("applicant")){e.next=8;break}throw new Error("Applicant already exists!");case 8:l.applicant={name:n.name,uid:n.uid},r.update(a,l),p(Object.assign({},l,{id:s.id})),e.next=46;break;case 13:if(i!==d.id){e.next=27;break}return m=t.timeslot(i),e.next=17,r.get(m);case 17:if(f=e.sent,h=Object.assign({},f.data()),(null===(u=h.applicant)||void 0===u?void 0:u.uid)===n.uid){e.next=21;break}throw new Error("Timeslot owned by other applicant!");case 21:delete h.applicant,r.set(m,h),p({}),o="unschedule",e.next=46;break;case 27:return w=t.timeslot(d.id),e.next=30,r.get(w);case 30:if(v=e.sent,g=Object.assign({},v.data()),(null===(b=g.applicant)||void 0===b?void 0:b.uid)===n.uid){e.next=34;break}throw new Error("Timeslot owned by other applicant!");case 34:return delete g.applicant,y=t.timeslot(i),e.next=38,r.get(y);case 38:if(x=e.sent,!(O=Object.assign({},x.data())).hasOwnProperty("applicant")){e.next=42;break}throw new Error("Applicant already exists!");case 42:O.applicant={name:n.name,uid:n.uid},r.set(w,g),r.update(y,O),p(Object.assign({},O,{id:x.id}));case 46:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Transaction failure!",e.t0),f()("Uh oh!","Something went wrong with saving your selections! Please refresh the page and try again!","error");case 11:if("schedule"!==o){e.next=17;break}return e.next=14,t.timeslotSelected({firstName:n.name.split(" ")[0],email:n.email,time:Object(y.a)(r.time)}).catch((function(e){return console.error(e)}));case 14:f()({title:"You're all set!",content:a.a.createElement("span",null,"Your interview is scheduled for"," ",a.a.createElement("strong",null,Object(y.a)(r.time),", ",r.time.toDateString()),"! A confirmation has also been sent to your email."),icon:"success"}),e.next=21;break;case 17:if("unschedule"!==o){e.next=21;break}return e.next=20,t.timeslotUnselected({firstName:n.name.split(" ")[0],email:n.email}).catch((function(e){return console.error(e)}));case 20:f()("Unscheduled!","You have unscheduled your interview, and a confirmation has been sent to your email. If you'd still like to interview with UPE, make sure to select another timeslot!","success");case 21:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}();return a.a.createElement(j.a,{style:{width:300,flex:"none"}},a.a.createElement("h1",null,r),i.sort((function(e,t){return e.time.getTime()===t.time.getTime()?e.id>t.id?1:-1:e.time>t.time?1:-1})).map((function(e){return a.a.createElement(M,{key:e.id,onClick:function(){return o(e)},selected:e.id===d.id},a.a.createElement(g.a.Body,null,a.a.createElement(g.a.Title,null,Object(y.a)(e.time)),a.a.createElement(g.a.Subtitle,{className:"mb-2 text-muted"},Object.values(e.interviewers).join(", ")),a.a.createElement(g.a.Subtitle,{className:"mb-2 text-muted"},e.timeslotLength," mins")))})))};return a.a.createElement(O.c,{flexdirection:"column"},a.a.createElement("h1",null,"Applicant Timeslot Selection"),a.a.createElement("p",null,"The timeslots below show times, length, and interviewers. Don't select a timeslot with interviewers that you know."),a.a.createElement(E.a,null,Object.entries(s).sort((function(e,t){return new Date(e[0])>new Date(t[0])?1:-1})).map((function(e){var t=e[0],n=e[1];return a.a.createElement(T,{key:t,date:t,slots:n})}))))})),B=function(){var e=Object(r.useContext)(o.AuthUserContext);return Object(i.f)(e)?a.a.createElement(C,null):a.a.createElement(A,null)};t.default=function(){return a.a.createElement(s.a,null,a.a.createElement(B,null))}}}]);
//# sourceMappingURL=component---src-pages-timeslots-js-b2e39b34926bcaa3ef4c.js.map